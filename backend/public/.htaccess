# Ativa o módulo de reescrita de URL
RewriteEngine On

# Define o diretório base para as regras de reescrita
RewriteBase /

# Adiciona cabeçalhos CORS
<IfModule mod_headers.c>
    Header always set Access-Control-Allow-Origin "http://localhost:3000"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, PATCH"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With, X-CSRF-TOKEN, Accept, Origin"
    Header always set Access-Control-Allow-Credentials "true"
    Header always set Access-Control-Max-Age "86400"
    
    # Responde imediatamente para requisições OPTIONS
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
</IfModule>

# Responder imediatamente para requisições OPTIONS
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ - [R=200,L]

# Não aplica regras de reescrita ao arquivo index.php
RewriteRule ^index\.php$ - [L]

# Verifica se o arquivo solicitado não existe
RewriteCond %{REQUEST_FILENAME} !-f
# Verifica se o diretório solicitado não existe
RewriteCond %{REQUEST_FILENAME} !-d

# Redireciona todas as requisições para o index.php (front controller)
RewriteRule . /index.php [L]

# CORS Headers
<IfModule mod_headers.c>
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With, X-CSRF-TOKEN, Accept, Origin"
    
    # Handle preflight requests (OPTIONS)
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
</IfModule> 